<!DOCTYPE html>
<html>
<head>
	<title>회원가입</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="css/register.css">
</head>
<body>
	<h1>회 원 가 입</h1>
	<form>
		<label for="username">아이디:</label><br>
		<input type="text" id="reg-id" name="username"><br>
		<label for="password">비밀번호:</label><br>
		<input type="password" id="reg-password" name="password"><br>
		<label for="confirm_password">비밀번호 확인:</label><br>
		<input type="password" id="confirm_password" name="confirm_password"><br>
		<label for="email">이메일:</label><br>
		<input type="text" id="email" name="email"><br>
        <label for="gender">성별:</label><br>
        <input type="radio" id="gender-m" name="gender" value="남자" checked="checked"
            style="margin-top: 20px">남자
        <input type="radio" id="gender-f" name="gender" value="여자"
            style="margin-bottom: 20px">여자<br>
        <label type="birth">생년월일:</label><br>
        <input type="date" id="birth"
            min="1900-01-01" max="2023-12-30" value="2023-04-01"
            style="margin-top: 10px; height: 35px; width:150px; font-size: 15px"><br>
		<button type="button" style="margin-top: 50px" onclick="submitForm()">회원가입</button>
	</form>

	<script>
		function submitForm() {
            location.href = 'preference.html'

			var id = document.getElementById('reg-id').value;
            var password = document.getElementById('reg-password').value;
            var confirm_password = document.getElementById('confirm_password').value;
            var email_address = document.getElementById('email').value;
            
            // 공란 처리
            if (id.length === 0) {
                alert('아이디를 입력해주세요')
                return
            } else if (password.length === 0) {
                alert('비밀번호를 입력해주세요.')
                return
            } else if (confirm_password === 0) {
                alert('비밀번호를 재입력해주세요.')
                return
            } else if (email.length === 0) {
                alert('이메일을 입력해주세요.')
                return
            }
            
            // 비밀번호, 재입력 비밀번호 일치 확인
            if (password !== confirm_password) {
                alert('비밀번호가 일치하지 않습니다.')
                return
            }

            // 이외 진행
            const xhr = new XMLHttpRequest();
            const url = "";  // 서버 url
            const data = JSON.stringify({
                id: id
            });

            xhr.open("POST", url);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        if (response.exists) {
                            alert('이미 존재하는 아이디입니다.');
                        } else {
                            const userData = {
                                id: id,
                                password: password,
                                email: email
                            };
                            const registerXHR = new XMLHttpRequest();
                            const registerUrl = '';  // 등록 url
                            const registerData = JSON.stringify(userData);

                            registerXHR.open("POST", registerUrl);
                            registerXHR.setRequestHeader("Content-Type", "application/json");

                            registerXHR.onreadystatechange = function() {
                                if (registerXHR.readyState === 4 && registerXHR.status === 200) {
                                    const registerResponse = JSON.parse(registerXHR.responseText)
                                    alert('회원가입이 완료되었습니다.');
                                    location.href = 'preference.html'
                                }
                            };

                            registerXHR.send(registerData);
                        }
                    } else {
                        alert('오류가 발생하였습니다.');
                    }
                }
            };

            xhr.send(data)
		}
	</script>
</body>
</html>